{"version":3,"sources":["file:///D:/cocosProject/footBallGame/game/node_modules/engine.io-client/build/esm/transports/webtransport.js"],"names":["WT","Transport","nextTick","createPacketDecoderStream","createPacketEncoderStream","name","doOpen","_transport","WebTransport","createUri","opts","transportOptions","err","emitReserved","closed","then","onClose","catch","onError","ready","createBidirectionalStream","stream","decoderStream","Number","MAX_SAFE_INTEGER","socket","binaryType","reader","readable","pipeThrough","getReader","encoderStream","pipeTo","writable","_writer","getWriter","read","done","value","onPacket","packet","type","query","sid","data","write","onOpen","packets","i","length","lastPacket","setTimeoutFn","doClose","_a","close"],"mappings":";;;iFAWaA,E;;;;;;AAXJC,MAAAA,S,gBAAAA,S;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,yB,mBAAAA,yB;AAA2BC,MAAAA,yB,mBAAAA,yB;;;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;oBACaJ,E,GAAN,MAAMA,EAAN,SAAiBC,SAAjB,CAA2B;AACtB,YAAJI,IAAI,GAAG;AACP,iBAAO,cAAP;AACH;;AACDC,QAAAA,MAAM,GAAG;AACL,cAAI;AACA;AACA,iBAAKC,UAAL,GAAkB,IAAIC,YAAJ,CAAiB,KAAKC,SAAL,CAAe,OAAf,CAAjB,EAA0C,KAAKC,IAAL,CAAUC,gBAAV,CAA2B,KAAKN,IAAhC,CAA1C,CAAlB;AACH,WAHD,CAIA,OAAOO,GAAP,EAAY;AACR,mBAAO,KAAKC,YAAL,CAAkB,OAAlB,EAA2BD,GAA3B,CAAP;AACH;;AACD,eAAKL,UAAL,CAAgBO,MAAhB,CACKC,IADL,CACU,MAAM;AACZ,iBAAKC,OAAL;AACH,WAHD,EAIKC,KAJL,CAIYL,GAAD,IAAS;AAChB,iBAAKM,OAAL,CAAa,oBAAb,EAAmCN,GAAnC;AACH,WAND,EARK,CAeL;;;AACA,eAAKL,UAAL,CAAgBY,KAAhB,CAAsBJ,IAAtB,CAA2B,MAAM;AAC7B,iBAAKR,UAAL,CAAgBa,yBAAhB,GAA4CL,IAA5C,CAAkDM,MAAD,IAAY;AACzD,oBAAMC,aAAa,GAAGnB,yBAAyB,CAACoB,MAAM,CAACC,gBAAR,EAA0B,KAAKC,MAAL,CAAYC,UAAtC,CAA/C;AACA,oBAAMC,MAAM,GAAGN,MAAM,CAACO,QAAP,CAAgBC,WAAhB,CAA4BP,aAA5B,EAA2CQ,SAA3C,EAAf;AACA,oBAAMC,aAAa,GAAG3B,yBAAyB,EAA/C;AACA2B,cAAAA,aAAa,CAACH,QAAd,CAAuBI,MAAvB,CAA8BX,MAAM,CAACY,QAArC;AACA,mBAAKC,OAAL,GAAeH,aAAa,CAACE,QAAd,CAAuBE,SAAvB,EAAf;;AACA,oBAAMC,IAAI,GAAG,MAAM;AACfT,gBAAAA,MAAM,CACDS,IADL,GAEKrB,IAFL,CAEU,CAAC;AAAEsB,kBAAAA,IAAF;AAAQC,kBAAAA;AAAR,iBAAD,KAAqB;AAC3B,sBAAID,IAAJ,EAAU;AACN;AACH;;AACD,uBAAKE,QAAL,CAAcD,KAAd;AACAF,kBAAAA,IAAI;AACP,iBARD,EASKnB,KATL,CASYL,GAAD,IAAS,CACnB,CAVD;AAWH,eAZD;;AAaAwB,cAAAA,IAAI;AACJ,oBAAMI,MAAM,GAAG;AAAEC,gBAAAA,IAAI,EAAE;AAAR,eAAf;;AACA,kBAAI,KAAKC,KAAL,CAAWC,GAAf,EAAoB;AAChBH,gBAAAA,MAAM,CAACI,IAAP,GAAe,WAAU,KAAKF,KAAL,CAAWC,GAAI,IAAxC;AACH;;AACD,mBAAKT,OAAL,CAAaW,KAAb,CAAmBL,MAAnB,EAA2BzB,IAA3B,CAAgC,MAAM,KAAK+B,MAAL,EAAtC;AACH,aAzBD;AA0BH,WA3BD;AA4BH;;AACDD,QAAAA,KAAK,CAACE,OAAD,EAAU;AACX,eAAKd,QAAL,GAAgB,KAAhB;;AACA,eAAK,IAAIe,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,OAAO,CAACE,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,kBAAMR,MAAM,GAAGO,OAAO,CAACC,CAAD,CAAtB;AACA,kBAAME,UAAU,GAAGF,CAAC,KAAKD,OAAO,CAACE,MAAR,GAAiB,CAA1C;;AACA,iBAAKf,OAAL,CAAaW,KAAb,CAAmBL,MAAnB,EAA2BzB,IAA3B,CAAgC,MAAM;AAClC,kBAAImC,UAAJ,EAAgB;AACZhD,gBAAAA,QAAQ,CAAC,MAAM;AACX,uBAAK+B,QAAL,GAAgB,IAAhB;AACA,uBAAKpB,YAAL,CAAkB,OAAlB;AACH,iBAHO,EAGL,KAAKsC,YAHA,CAAR;AAIH;AACJ,aAPD;AAQH;AACJ;;AACDC,QAAAA,OAAO,GAAG;AACN,cAAIC,EAAJ;;AACA,WAACA,EAAE,GAAG,KAAK9C,UAAX,MAA2B,IAA3B,IAAmC8C,EAAE,KAAK,KAAK,CAA/C,GAAmD,KAAK,CAAxD,GAA4DA,EAAE,CAACC,KAAH,EAA5D;AACH;;AAnE6B,O","sourcesContent":["import { Transport } from \"../transport.js\";\nimport { nextTick } from \"../globals.node.js\";\nimport { createPacketDecoderStream, createPacketEncoderStream, } from \"engine.io-parser\";\n/**\n * WebTransport transport based on the built-in `WebTransport` object.\n *\n * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n * @see https://caniuse.com/webtransport\n */\nexport class WT extends Transport {\n    get name() {\n        return \"webtransport\";\n    }\n    doOpen() {\n        try {\n            // @ts-ignore\n            this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed\n            .then(() => {\n            this.onClose();\n        })\n            .catch((err) => {\n            this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(() => {\n            this._transport.createBidirectionalStream().then((stream) => {\n                const decoderStream = createPacketDecoderStream(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n                const reader = stream.readable.pipeThrough(decoderStream).getReader();\n                const encoderStream = createPacketEncoderStream();\n                encoderStream.readable.pipeTo(stream.writable);\n                this._writer = encoderStream.writable.getWriter();\n                const read = () => {\n                    reader\n                        .read()\n                        .then(({ done, value }) => {\n                        if (done) {\n                            return;\n                        }\n                        this.onPacket(value);\n                        read();\n                    })\n                        .catch((err) => {\n                    });\n                };\n                read();\n                const packet = { type: \"open\" };\n                if (this.query.sid) {\n                    packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n                }\n                this._writer.write(packet).then(() => this.onOpen());\n            });\n        });\n    }\n    write(packets) {\n        this.writable = false;\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            this._writer.write(packet).then(() => {\n                if (lastPacket) {\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n}\n"]}