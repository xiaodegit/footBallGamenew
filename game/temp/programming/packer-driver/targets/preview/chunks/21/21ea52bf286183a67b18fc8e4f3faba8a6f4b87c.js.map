{"version":3,"sources":["file:///D:/cocosProject/footBallGame/game/node_modules/socket.io-parser/build/esm/binary.js"],"names":["deconstructPacket","packet","buffers","packetData","data","pack","_deconstructPacket","attachments","length","isBinary","placeholder","_placeholder","num","push","Array","isArray","newData","i","Date","key","Object","prototype","hasOwnProperty","call","reconstructPacket","_reconstructPacket","isIndexValid","Error"],"mappings":"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","sourcesContent":["import { isBinary } from \"./is-binary.js\";\n/**\n * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @public\n */\nexport function deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return { packet: pack, buffers: buffers };\n}\nfunction _deconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (isBinary(data)) {\n        const placeholder = { _placeholder: true, num: buffers.length };\n        buffers.push(data);\n        return placeholder;\n    }\n    else if (Array.isArray(data)) {\n        const newData = new Array(data.length);\n        for (let i = 0; i < data.length; i++) {\n            newData[i] = _deconstructPacket(data[i], buffers);\n        }\n        return newData;\n    }\n    else if (typeof data === \"object\" && !(data instanceof Date)) {\n        const newData = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                newData[key] = _deconstructPacket(data[key], buffers);\n            }\n        }\n        return newData;\n    }\n    return data;\n}\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @public\n */\nexport function reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n}\nfunction _reconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (data && data._placeholder === true) {\n        const isIndexValid = typeof data.num === \"number\" &&\n            data.num >= 0 &&\n            data.num < buffers.length;\n        if (isIndexValid) {\n            return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n        }\n        else {\n            throw new Error(\"illegal attachments\");\n        }\n    }\n    else if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            data[i] = _reconstructPacket(data[i], buffers);\n        }\n    }\n    else if (typeof data === \"object\") {\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                data[key] = _reconstructPacket(data[key], buffers);\n            }\n        }\n    }\n    return data;\n}\n"]}